<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News portal: AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f8f8;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 1rem 0;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .search-box {
            background: white;
            padding: 1rem 0;
            text-align: center;
        }

        .search-box input {
            padding: 10px;
            width: 300px;
            border: 3px solid black;
            border-radius: 4px;
            font-size: 16px;
        }

        .search-box button {
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .search-box button:hover {
            background: #2980b9;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .news-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .news-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .news-card h3 a {
            color: #2c3e50;
            text-decoration: none;
        }

        .news-card h3 a:hover {
            color: #3e93cc;
        }

        .news-card p {
            color: #666666;
            margin-bottom: 10px;
        }

        .news-meta {
            font-size: 0.9rem;
            color: #999999;
            border-top: 1px solid #eeeeee;
            padding-top: 10px;
        }

        .source {
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .search-box input {
                max-width: 100%;
                margin-bottom: 8px;
            }
            
            .search-box button {
                width: calc(33.33% - 10px);
                margin: 2px 5px 2px 0;
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .news-card {
                padding: 12px;
            }
            
            .news-card h3 {
                font-size: 1rem;
            }
            
            .news-card p {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>News Portal: AI</h1>
            <p>Latest news about Artificial Intelligence</p>
        </div>
    </header>

    <div class="search-box">
        <div class="container">
            <input type="text" id="searchInput" placeholder="Search news...">
            <button onclick="searchNews()">Search</button>
            <button onclick="clearSearch()">Clear</button>
            <button onclick="refreshNews()">Refresh</button>
        </div>
    </div>

    <main class="container">
        <div id="loading" style="text-align: center; padding: 20px; display: none;">
            <p>Loading news...</p>
        </div>
        <div id="newsGrid" class="news-grid">
        </div>
    </main>

    <script>
        const NEWSAPI_KEY = 'c1edd6adf2524c59b96063443c9163ef';
        const GUARDIAN_API_KEY = 'test';

        let allNews = [];
        let filteredNews = [];

        function isAIRelated(title, description) {
            const content = (title + ' ' + description).toLowerCase();
            
            const aiKeywords = [
                'artificial intelligence', 'ai ', ' ai', 'machine learning',
                'deep learning', 'chatgpt', 'gpt', 'openai',
                'llm', 'large language model', 'generative ai', 'algorithm',
                'automation', 'robot', 'autonomous', 'computer vision', 'data science',
                'predictive analytics', 'cognitive computing', 'smart technology',
                'intelligent system', 'ai-powered', 'ai-driven', 'machine intelligence',
                'artificial neural', 'reinforcement learning',
                'google ai', 'microsoft ai', 'meta ai', 'anthropic', 'claude',
                'bard', 'gemini', 'copilot', 'midjourney', 'stable diffusion',
                'ai model', 'ai technology', 'ai research', 'ai development',
                'ai ethics', 'ai safety', 'ai regulation', 'ai industry'
            ];
            
            return aiKeywords.some(keyword => content.includes(keyword));
        }

        async function fetchNews() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            console.log('[v0] === AI NEWS PORTAL DEBUG ===');
            console.log('[v0] Using NewsAPI, Guardian API, and Hacker News API');
            console.log('[v0] Starting API calls...');
            
            const [newsApiResults, guardianResults, hackerNewsResults] = await Promise.allSettled([
                fetchFromNewsAPI(),
                fetchFromGuardianAPI(),
                fetchFromHackerNewsAPI()
            ]);
            
            let combinedNews = [];
            
            if (newsApiResults.status === 'fulfilled' && newsApiResults.value.length > 0) {
                console.log('[v0] NewsAPI returned', newsApiResults.value.length, 'articles');
                combinedNews = [...combinedNews, ...newsApiResults.value];
            } else {
                console.log('[v0] NewsAPI failed or returned no results');
            }
            
            if (guardianResults.status === 'fulfilled' && guardianResults.value.length > 0) {
                console.log('[v0] Guardian API returned', guardianResults.value.length, 'articles');
                combinedNews = [...combinedNews, ...guardianResults.value];
            } else {
                console.log('[v0] Guardian API failed or returned no results');
            }
            
            if (hackerNewsResults.status === 'fulfilled' && hackerNewsResults.value.length > 0) {
                console.log('[v0] Hacker News API returned', hackerNewsResults.value.length, 'articles');
                combinedNews = [...combinedNews, ...hackerNewsResults.value];
            } else {
                console.log('[v0] Hacker News API failed or returned no results');
            }
            
            if (combinedNews.length > 0) {
                const aiFilteredNews = combinedNews.filter(article => 
                    isAIRelated(article.title, article.description)
                );
                
                console.log('[v0] Filtered from', combinedNews.length, 'to', aiFilteredNews.length, 'AI-related articles');
                
                aiFilteredNews.sort((a, b) => new Date(b.publishedAt || b.date) - new Date(a.publishedAt || a.date));
                allNews = aiFilteredNews;
                filteredNews = [...allNews];
                displayNews(filteredNews);
                console.log('[v0] Successfully loaded', allNews.length, 'AI articles from multiple sources');
            } else {
                console.log('[v0] All APIs failed, loading mock data');
                loadMockData();
            }
            
            loading.style.display = 'none';
        }

        async function fetchFromNewsAPI() {
            console.log('[v0] Fetching from NewsAPI...');
            
            try {
                const apiUrl = `https://newsapi.org/v2/everything?q=artificial%20intelligence%20OR%20machine%20learning%20OR%20AI%20OR%20ChatGPT%20OR%20OpenAI&sortBy=publishedAt&pageSize=15&apiKey=${NEWSAPI_KEY}`;
                
                const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(apiUrl)}`;
                
                console.log('[v0] NewsAPI: Making request through proxy...');
                
                const response = await fetch(proxyUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('[v0] NewsAPI: Raw response received');
                
                if (data.status !== 'ok') {
                    throw new Error(`NewsAPI error: ${data.message || 'Unknown error'}`);
                }
                
                if (!data.articles || data.articles.length === 0) {
                    throw new Error('No articles found');
                }
                
                console.log('[v0] NewsAPI: Processing', data.articles.length, 'articles');
                
                return data.articles.map(article => ({
                    title: article.title || 'No title',
                    description: article.description || 'No description available',
                    url: article.url || '#',
                    source: 'NewsAPI',
                    date: formatDate(article.publishedAt),
                    publishedAt: article.publishedAt
                }));
                
            } catch (error) {
                console.error('[v0] NewsAPI failed:', error.message);
                throw error;
            }
        }

        async function fetchFromGuardianAPI() {
            console.log('[v0] Fetching from Guardian API...');
            
            try {
                const apiUrl = `https://content.guardianapis.com/search?q=artificial%20intelligence%20OR%20machine%20learning%20OR%20AI%20OR%20technology&section=technology&show-fields=headline,trailText,shortUrl&page-size=20&order-by=newest&api-key=${GUARDIAN_API_KEY}`;
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                
                if (data.response.status !== 'ok') throw new Error('Guardian API error');
                if (!data.response.results || data.response.results.length === 0) throw new Error('No articles found');
                
                console.log('[v0] Guardian: Retrieved', data.response.results.length, 'articles for AI filtering');
                
                return data.response.results.map(article => ({
                    title: article.fields?.headline || article.webTitle || 'No title',
                    description: article.fields?.trailText || 'No description available',
                    url: article.fields?.shortUrl || article.webUrl || '#',
                    source: 'Guardian Tech',
                    date: formatDate(article.webPublicationDate),
                    publishedAt: article.webPublicationDate
                }));
                
            } catch (error) {
                console.error('[v0] Guardian API failed:', error.message);
                throw error;
            }
        }

        async function fetchFromHackerNewsAPI() {
            console.log('[v0] Fetching from Hacker News API...');
            
            try {
                const topStoriesResponse = await fetch('https://hacker-news.firebaseio.com/v0/topstories.json');
                if (!topStoriesResponse.ok) throw new Error(`HTTP ${topStoriesResponse.status}`);
                
                const topStoryIds = await topStoriesResponse.json();
                console.log('[v0] Hacker News: Got', topStoryIds.length, 'top story IDs');
                
                const storyPromises = topStoryIds.slice(0, 30).map(async (id) => {
                    try {
                        const response = await fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`);
                        if (!response.ok) return null;
                        return await response.json();
                    } catch (error) {
                        console.error('[v0] Failed to fetch story', id, ':', error.message);
                        return null;
                    }
                });
                
                const stories = await Promise.all(storyPromises);
                
                const validStories = stories.filter(story => 
                    story && 
                    story.title && 
                    story.url
                );
                
                console.log('[v0] Hacker News: Found', validStories.length, 'stories for AI filtering');
                
                return validStories.slice(0, 15).map(story => ({
                    title: story.title || 'No title',
                    description: story.text ? 
                        story.text.replace(/<[^>]*>/g, '').substring(0, 200) + '...' : 
                        `${story.score || 0} points • ${story.descendants || 0} comments`,
                    url: story.url || `https://news.ycombinator.com/item?id=${story.id}`,
                    source: 'Hacker News',
                    date: formatDate(new Date(story.time * 1000).toISOString()),
                    publishedAt: new Date(story.time * 1000).toISOString()
                }));
                
            } catch (error) {
                console.error('[v0] Hacker News API failed:', error.message);
                throw error;
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffHours < 1) return 'Just now';
            if (diffHours < 24) return `${diffHours} hours ago`;
            if (diffDays < 7) return `${diffDays} days ago`;
            return date.toLocaleDateString();
        }

        function loadMockData() {
            allNews = [
                {
                    title: "OpenAI Releases GPT-5 with Enhanced Reasoning Capabilities",
                    description: "The latest version of GPT shows significant improvements in logical reasoning and problem-solving tasks.",
                    url: "#",
                    source: "NewsAPI",
                    date: "1 hours ago"
                },
                {
                    title: "Google's New AI Model Achieves Breakthrough in Medical Diagnosis",
                    description: "Researchers demonstrate 95% accuracy in detecting rare diseases from medical imaging data.",
                    url: "#",
                    source: "Guardian",
                    date: "2 hours ago"
                },
                {
                    title: "Meta Announces Open-Source AI Framework for Developers",
                    description: "New tools make it easier for developers to build and deploy AI applications at scale.",
                    url: "#",
                    source: "Hacker News",
                    date: "18 hours ago"
                },
                {
                    title: "AI-Powered Climate Models Predict Weather with 99% Accuracy",
                    description: "Machine learning algorithms are revolutionizing weather forecasting and climate research.",
                    url: "#",
                    source: "NewsApi",
                    date: "3 hours ago"
                },
                {
                    title: "Autonomous Vehicles Pass Major Safety Milestone",
                    description: "Self-driving cars complete 1 million miles of testing without human intervention.",
                    url: "#",
                    source: "Guardian",
                    date: "7 hours ago"
                },
                {
                    title: "AI Ethics Committee Proposes New Industry Standards",
                    description: "Global initiative aims to establish responsible AI development practices across all sectors.",
                    url: "#",
                    source: "Hacker News",
                    date: "5 day ago"
                }
            ];
            filteredNews = [...allNews];
            displayNews(filteredNews);
        }

        function displayNews(articles) {
            const newsGrid = document.getElementById('newsGrid');
            if (articles.length === 0) {
                newsGrid.innerHTML = '<p style="text-align: center; color: #666;">No news found matching your search.</p>';
                return;
            }
            
            newsGrid.innerHTML = articles.map(article => `
                <div class="news-card">
                    <h3><a href="${article.url}" target="_blank">${article.title}</a></h3>
                    <p>${article.description}</p>
                    <div class="news-meta">
                        <span class="source">${article.source}</span>
                        <span>${article.date}</span>
                    </div>
                </div>
            `).join('');
        }

        function searchNews() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredNews = allNews.filter(article => 
                    article.title.toLowerCase().includes(searchTerm) ||
                    article.description.toLowerCase().includes(searchTerm)
                );
            } else {
                filteredNews = [...allNews];
            }
            displayNews(filteredNews);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            filteredNews = [...allNews];
            displayNews(filteredNews);
        }

        function refreshNews() {
            fetchNews();
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetchNews();
        });

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchNews();
            }
        });
    </script>
</body>
</html>
